{% extends "/layout/default.html" %}

{% block title %}
	{{ doc.title }} - regular.express
{% endblock %}

{% block head %}
	{{ super() }}

	<link rel="stylesheet" type="text/css" href="/css/share_view.css">
{% endblock %}


{% block content %}
<section id="meta">
	<div class="first">
		<h2>{{ doc.title }}</h2>

		<div class="sub">
			<img class="profile" src="https://avatars.githubusercontent.com/u/{{ author.social_uid }}?size=44">
			<span class="author-name">{{ author.name }}</span>
			<span class="datetime">
				{{ datetime.fromtimestamp(doc.created / 1000).strftime('%Y-%m-%d %H:%M:%S') }}
			</span>
		</div>
	</div>

	<div class="second">
		<pre id="description">{{ doc.description }}</pre>

		<div class="tags">
			<span class="tag tag-special">
				<a href="/env/{{ doc.env[0] }}">
					<span class="env-group">{{ doc.env[0] }}&gt;</span>
				</a>
				<a href="/env/{{ doc.env[0] }}/{{ doc.env[1] }}">
					<span class="env-child">{{ doc.env[1] }}</span>
				</a>
			</span>

			{% for tag in doc.tags : %}
			<a href="/tag/{{ tag }}">
				<span class="tag">
					<span>#</span>
					<span>{{ tag }}</span>
				</span>
			</a>
			{% endfor %}
		</div>
	</div>
</section>

{% if doc.properties %}
<section id="properties">
	<h3>properties</h3>

	<div class="content">
		<table>
			<tbody>
				{% for prop in env.info.properties %}
				<tr>
					<td class="key">
						{{ prop.name }}
					</td>
					<td class="value">
						<span>{{ doc.properties[ prop.name ] }}</span>
					</td>
				</tr>
				{% endfor %}
			</tbody>
		</table>
	</div>

	<!--<ul class="content">
		{% for prop in env.info.properties %}
		<li class="clearfix">
			<div class="fl key">
				{{ prop.name }}
			</div>
			<div class="fl value">
				{{ doc.properties[ prop.name ] }}
			</div>
		</li>
		{% endfor %}
	</ul>-->
</section>
{% endif %}


<section id="input">
	<h3>input</h3>

	<table class="lines">
		<tbody>
			<tr>
				<td class="line-number">
					{% for line in doc.input %}
					<div class="{{ ['e','o'][loop.index % 2] }}">{{ loop.index }}</div>
					{% endfor %}
				</td>
				<td class="data">
					{% for line in doc.input %}
					<div class="{{ ['e','o'][loop.index % 2] }}">{{ line }}</div>
					{% endfor %}
				</td>
			</tr>
		</tbody>
	</table>
</section>

<section id="output">
	<h3>output</h3>
	<table class="lines">
		<tbody>
			{% set type = doc.output.type %}


			{% if type == 'GROUP' %}
				<!-- GROUP type -->
				<tr class="columns">
					<td></td>
					{% for col in doc.output.result.columns %}
						<td><div>{{ col }}</div></td>
					{% endfor %}
					<td style="width:100%">&nbsp;</td>
				</tr>

				{% for dataset in doc.output.result.resultList %}
				{% set eo = ['e','o'][loop.index % 2] %}
				<tr>
					<td class="line-number">
						<div class="{{ eo }}">{{ loop.index }}</div>
					</td>

					{% if dataset %}
						{% for data in dataset %}
						<td class="data group-data">
							<div class="{{ eo }}">{{ data }}</div>
						</td>
						{% endfor %}

					{% else %}
						<td class="data group-data-null" colspan="3">
							<div class="{{ eo }}">Null</div>
						</td>
					{% endif %}

					<td class="data" style="width:100%"><div class="{{ eo }}">&nbsp;</div></td>
				</tr>
				{% endfor %}


			{% else %}
			<!-- STRING or MATCH type -->
			<tr>
				<td class="line-number">
					{% for line in doc.output.result.resultList %}
					<div class="{{ ['e','o'][loop.index % 2] }}">{{ loop.index }}</div>
					{% endfor %}
				</td>
				<td class="data">
					{% for line in doc.output.result.resultList %}
					<div class="{{ ['e','o'][loop.index % 2] }}">
						{% if type == 'STRING' %}
							{{ line|e|default('&nbsp;', True)|safe }}

						{% elif type == 'MATCH' %}
							{{ 'Matched' if val else 'UnMatched' }}
						{% endif %}

					</div>
					{% endfor %}
				</td>
			</tr>

			{% endif %}
		</tbody>
	</table>
</section>

{% endblock %}
