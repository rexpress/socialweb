<?xml version="1.0" encoding="UTF-8" ?>
<site>

	<!-- render home -->
	{% set news = model.get('/re/_design/share/_view/news?include_docs=true&descending=true') %}
	<page>
		<url>/</url>
		<context type="json">
			{{ json.dumps( dict(
				news = group(
					news.rows,
					('key', 1),
					('key', 2)
				)
			)) }}
		</context>
		<template>home.html</template>
	</page>


	<!-- render shares -->
	{% set all_docs = model.post('/re/_find', {
		'selector': {
			'_id': { '$gt': 0 },
			'type': { '$eq': 'share' }
		},
		'fields': ['_id', '_rev'],
		'sort': [{ '_id': 'desc' }]
	}) %}

	{% for doc in all_docs.docs %}
	<page>
		<url>/share/{{ doc._id }}/</url>
		<context>
			{{
				model.get(
					api = '/re/_design/share/_view/share?keys=["' + doc._id +'"]&include_docs=true',
					immutable = True
				)
			}}
		</context>
		<template>document.html</template>
	</page>
	{% endfor %}


	<!-- render static pages -->
	<page>
		<url>/doc/</url>
		<template>under_cons.html</template>
	</page>
	<page>
		<url>/env/</url>
		<template>under_cons.html</template>
	</page>
	<page>
		<url>/down/</url>
		<template>under_cons.html</template>
	</page>
	<page>
		<url>/tag/</url>
		<template>under_cons.html</template>
	</page>
</site>
